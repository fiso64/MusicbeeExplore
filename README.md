# MusicbeeExplore

MusicbeeExplore is a plugin for MusicBee that allows users to browse MusicBrainz or Discogs in the music explorer view.

## Features

- Query Discogs or MusicBrainz for albums by an artist
- Fetch popular tracks for an artist from Last.fm
- Get similar album recommendations
- Seamless-ish integration with MusicBee's interface

## How It Works

The plugin integrates with MusicBee's interface and allows users to query external music databases (MusicBrainz and Discogs) for artist discographies and album information.

1. When a user searches for an artist or album, the plugin queries the selected database (MusicBrainz or Discogs) and retrieves the discography information.

2. The plugin creates dummy files for each track in the album. These dummy files contain metadata but no actual audio content.

3. When a user attempts to play a dummy file, the plugin intercepts the playback:
   - For unloaded albums, it fetches the track list and creates dummy files for all tracks in the album.
   - For unloaded tracks, it uses yt-dlp to search for and download the audio from YouTube.

4. The downloaded audio is saved in the opus format and replaces the dummy file. The metadata is then updated to reflect the downloaded state.

5. If configured, the plugin can use an external media player to stream audio directly without downloading.

This approach allows users to browse and play music from external sources directly within MusicBee without having to download entire albums upfront.

### Requirements

- **yt-dlp**: This tool is required for searching and downloading audio from YouTube. Make sure it's installed and available in your system PATH.
- **ffmpeg**: yt-dlp requires ffmpeg for audio conversion. Ensure it's installed and accessible to yt-dlp.

## Setup

1. Download the zip file from the releases page.
2. Extract `mb_MusicBeeExplore.dll` to the MusicBee plugins folder.
3. Add exclusions to all filters in MusicBee to avoid displaying the plugin's cached items:
   - Add a filter condition: comment does not contain `тий ` (the identifier of all files generated by this plugin)

## Usage

The plugin adds several commands and shortcuts:

1. Discogs Query: Search for albums by the selected or search box artist on Discogs
2. MusicBrainz Query: Search for albums by the selected or search box artist on MusicBrainz
3. Load Selected Albums: Import the selected albums into MusicBee
4. Toggle Cached Albums: Show or hide cached albums
5. Get Popular Tracks: Fetch popular tracks for the selected artist from Last.fm
6. Get Similar Albums: Find similar albums for the selected album

### Search Syntax

The plugin supports advanced search syntax for both MusicBrainz and Discogs queries:

#### MusicBrainz:

- `>query`: Retrieve more releases, including "appears on" releases
- `l:query`: Search for a label instead of an artist
- `"query"`: Perform an exact match search

#### Discogs:

- `>query`: Retrieve more releases, including "appears on" releases
- `>>query`: Retrieve even more releases (may contain junk)
- `l:query`: Search for a label instead of an artist
- `"query"`: Perform an exact match search

## Configuration

The plugin can be configured through MusicBee's plugin settings. Options include:

- Open results in a new tab
- Show download window
- Queue tracks after loading an album
- Get popular tracks when loading albums
- Use another media player to stream audio
- Set custom media player command
- Configure Discogs API token
- Set Last.fm API key

## Known Issues

- Track skipping during downloads: The plugin may not receive notifications while downloading a song, causing it to skip through remaining songs and download them all at once.
- Scrobbling issues: Artist names are prefixed with an identifier, affecting Last.fm scrobbling. Add the cache folder to excluded locations in the Last.fm plugin settings.
- Wavebar update: The wavebar is not updated after dummy tracks are downloaded, but the progress bar works fine.

## Todo

- Fix song skipping bug during downloads
- Implement download cancellation when track changes
- Synchronize access to downloader
- Preload next track when current playback is almost done
- Improve track playback speed
- Reduce false YouTube downloads
- Add Bandcamp retrieval and playback
- Implement Bandcamp and Discogs album suggestions
